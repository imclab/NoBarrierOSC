<!doctype html>
<html>
<head>
	<title>NoBarrierOSC Client</title>
	<!-- IPHONE WEB APP META/LINK TAGS -->
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
	<meta name="viewport" content="user-scalable=no, width=device-width, minimum-scale=1.0, maximum-scale=1.0"/>
	<link rel="apple-touch-icon" href="./images/apple-touch-icon.png"/>

	<style>
		body{ background-color:#dddddd; };
		.touchArea { width: 100%; height: 100%; overflow: auto;  border: 1px solid #eee; font: 11px Helvetica, Arial; }


		.packedCircle {
			-webkit-transition: transform3d 0s linear;
			-webkit-background-size: 100%;
			background-image: url("./images/smallCircle.png");
			background-size: 100%;
			width: 75px;
			height: 75px;
			position: absolute;
			left: 0;
			top: 0;
			border: 1px solid #eee;
		}
	</style>
	<script data-main="js/main.js" src="js/require-jquery-1.4.3.js"></script>
</head>
<body>

<script>
	/**
	 * Use this instead of onDocumentReady
	 */
	function onNoBarrierOSCInitComplete()
	{
		setupDocumentListeners();
		function setupDocumentListeners()
		{
			this.bounds = {left:0, top: 0, bottom:$(window).height(), right: $(window).width()};
			var self = this;
			var netChannelDelegate = new NetChannelDelegate();

			$(document).mousemove(function(event)
			{
				//CSV: x,y
				netChannelDelegate.send(GAMECONFIG.CMDS.PLAYER_MOVE, {x:event.pageX/self.bounds.right, y: event.pageY/self.bounds.bottom});
				event.preventDefault();
			});

			// Convert iphone touchevent to mouseevent
			function touchHandler(event)
			{
			    var touches = event.changedTouches,
			        first = touches[0],
			        type = "";

				event.preventDefault(); // Stop overscroll
			    switch(event.type)
			    {
			        case "touchstart": type = "mousedown"; break;
			        case "touchmove":  type="mousemove"; break;
			        case "touchend":   type="mouseup"; break;
			        default: return;
			    }

			    var fakeMouseEvent = document.createEvent("MouseEvent");
			    fakeMouseEvent.initMouseEvent(type, true, true, window, 1,
			                              first.screenX, first.screenY,
			                              first.clientX, first.clientY, false,
			                              false, false, false, 0/*left*/, null);

			    first.target.dispatchEvent(fakeMouseEvent);
			}

			document.addEventListener("touchstart", touchHandler, true);
			document.addEventListener("touchmove", touchHandler, true);
			document.addEventListener("touchend", touchHandler, true);
			document.addEventListener("touchcancel", touchHandler, true);
		}
	}
</script>
<div id="touchArea"></div>
<img style="position: absolute; top: 0; right: 0; border: 0;" src="images/fork.png" alt="Fork me on GitHub" />
</body>
</html>